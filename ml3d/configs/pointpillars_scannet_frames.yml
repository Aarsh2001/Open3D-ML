dataset:
  name: Scannet
  # [scenes|frames] Use point clouds from entire scenes or individual frames
  portion: frames
  # path/to/your/dataset
  dataset_path: /mnt/beegfs/tier1/vcl-nfs-work/ssheorey/Open3D/Datasets/ScanNet-cache
  cache_dir: ./logs/cache
  max_size: [1000, 200, null]
  #  steps_per_epoch_train: 5000

model:
  name: PointPillars
  # path/to/your/checkpoint
  ckpt_path:

  point_cloud_range: &point_cloud_range [-2.4, -1.8, 0, 2.4, 1.8, 4.5]   # TBC
  classes: [
    'cabinet', 'bed', 'chair', 'sofa', 'table', 'door', 'window',
    'bookshelf', 'picture', 'counter', 'desk', 'curtain',
    'refrigerator', 'showercurtrain', 'toilet', 'sink', 'bathtub',
    'garbagebin'
  ]

  loss:
    focal:
      gamma: 2.0
      alpha: 0.25
      loss_weight: 2.0  # *4
    smooth_l1:
      beta: 0.11
      loss_weight: 1.0  # =
    cross_entropy:
      loss_weight: 0.001  # /100

  voxelize:
    max_num_points: 16 # 256
    voxel_size: &vsize
      [0.03, 0.03, 4.5]             # TBC
      # [0.125, 0.125, 3.5]             # TBC
    max_voxels: [16000, 19200] # [768, 768]      # [P_train, P_test]

  voxel_encoder:
    in_channels: 3
    feat_channels: [64, 64, 64]  # 1 -> 3 layers
    voxel_size: *vsize

  scatter:
    in_channels: 64
    output_shape: [120, 160] # [24, 32]

  backbone:
    in_channels: 64
    out_channels: [64, 128, 256]
    layer_nums: [3, 6, 9]   # [3, 5, 5]
    layer_strides: [2, 2, 2]

  neck:
    in_channels: [64, 128, 256]
    out_channels: [128, 128, 128]
    upsample_strides: [1, 2, 4]
    use_conv_for_no_stride: false

  head:
    in_channels: 384
    feat_channels: 384
    nms_pre: 100
    score_thr: 0.5
    ranges: [                   # TBC
      [-2.4, -1.8, 0, 2.4, 1.8, 4.5]
    ]
    # Anchor box set spacing in voxels along each dimension
    stride: 2
    # 119 anchors. mIoU=0.696
    sizes: [
      [0.19876949885998085, 0.24266937807636912, 0.28191269289425025],
      [0.31178700845773133, 0.4337954083561997, 0.30323161932850407],
      [0.4358670461772783, 0.2677934283566846, 0.3738775907733425],
      [0.16030286223029144, 0.5416067830468705, 0.5227710807364455],
      [0.5757566613088555, 0.5629408196766243, 0.23311665058359576],
      [0.1319825105965874, 0.7895659437013218, 0.8289670261147715],
      [0.529338782486239, 0.2250274577096224, 0.7970701370475811],
      [0.25858714983110453, 0.46138906690291326, 0.9018119612543721],
      [1.4886259673447015, 0.22747190188098476, 0.33463235564579363],
      [0.528136059668407, 0.5316620794451219, 0.46107917279194155],
      [1.0074090764329238, 0.26618693728704834, 0.5083858236536256],
      [0.35502010600115796, 0.3479366613504238, 1.4371874034404761],
      [0.5550953579905317, 0.5487935252559353, 0.6564517873876707],
      [0.2270913160335688, 1.1641707009756312, 0.7630117442864304],
      [0.1793295973690071, 0.8945804328790721, 1.3054760352723205],
      [0.6520632209785454, 0.6678012593815297, 0.4944512147821189],
      [1.155094488328244, 0.21698356235728689, 0.9182285011315545],
      [0.4162040372358012, 0.3374434306205272, 1.9174795963482918],
      [0.9210010541207863, 0.22864639292462252, 1.284512370162539],
      [0.5595453980036275, 0.5487814210835706, 0.8824189639504928],
      [0.5804478432433012, 1.1398791370261072, 0.4472233965867193],
      [0.7788495375468489, 0.48614046769680996, 0.788330812311649],
      [0.5024647513112555, 0.7349764475291816, 0.8286336980771518],
      [0.22474550471549293, 1.8652203225753676, 0.7394145858067438],
      [0.8652237706507244, 0.8453145514996281, 0.43042948347560805],
      [0.19346547667341252, 0.8229366866061887, 1.990440583342425],
      [0.21146213270783376, 0.952939391376511, 1.6609103567898336],
      [1.8491746438272045, 0.23254275123278356, 0.8230438869107849],
      [0.90685816741015, 0.23622692714462568, 1.6939991829119183],
      [0.6787676968322207, 0.6718682229714279, 0.8251881525199507],
      [0.7424073322130411, 1.5814009357426078, 0.327613765745419],
      [0.9187076178111303, 0.20741947475481481, 2.018499015924937],
      [1.5067555611017518, 0.7091984640468244, 0.393512991724812],
      [0.20276256735199705, 1.381276305753796, 1.5709775983397694],
      [0.6697143172113214, 0.6730725431975526, 1.0114821806121561],
      [1.1304274972220105, 1.1366403151051445, 0.3772849986343697],
      [0.2487193845798381, 1.0739015689391755, 2.0521825866082866],
      [0.6453283019099668, 3.105721930240067, 0.288151361735155],
      [0.8375385533106071, 0.8729719809634601, 0.8075770069543406],
      [1.3382600705952166, 0.30613087891690305, 1.457053038340995],
      [1.2405008275340064, 0.6341078739277262, 0.7646185516675161],
      [2.6307877014080687, 0.3794974004228916, 0.6163284239669637],
      [1.1813825566468672, 0.24975047053220734, 2.1756682162770753],
      [0.5568387622512485, 1.120845230014328, 1.0322306586422245],
      [0.43340363205638927, 1.6243723983430671, 1.013872840061262],
      [0.8978057649900327, 0.7944999586298779, 1.0689017462280557],
      [0.8057733726501465, 2.2875797376632683, 0.4195675691366191],
      [1.460629608293976, 2.151529152586002, 0.2461702007837968],
      [0.27370300388429425, 3.182907962240282, 0.8897893857210872],
      [0.7356355894659818, 1.3039421527809616, 0.814348006004227],
      [0.34479208568088304, 2.4926766905224795, 0.9928320442375385],
      [0.3085838296505651, 1.9367920172433055, 1.44703521893612],
      [0.7604760786326377, 0.7534639843933866, 1.5954777658414527],
      [1.599564661460097, 0.6114750606104435, 0.9393378526548511],
      [0.3062267891118221, 4.209723130078384, 0.7223585613176854],
      [1.899132507590835, 0.3717344422494213, 1.3577476268173558],
      [0.8788873389095602, 4.371002434256551, 0.2531632620417431],
      [1.0888353441212624, 1.0713524861225288, 0.847879189920242],
      [2.4410390053016315, 1.6079678056783195, 0.2534592409967005],
      [0.8152141445442508, 1.5639842175197542, 0.8111339415850394],
      [0.8150969038838918, 0.6365438444273817, 2.14391202171397],
      [1.555230625762851, 0.9273359073843046, 0.8032651045250657],
      [1.6628084940276115, 0.30512666760994367, 2.316442188370993],
      [0.4039255960603779, 1.305944830648015, 2.338584383418055],
      [1.7216422862476757, 2.9796961484132027, 0.24107490203998805],
      [2.3560968068015202, 0.49870927549722605, 1.057916336485094],
      [1.932829039103508, 0.3683214987359462, 1.910802831502854],
      [1.924927662681125, 0.9095299060204457, 0.7912473095865828],
      [0.9103718424836794, 1.8944737015127366, 0.843173461351671],
      [0.8251783111029202, 1.0288007437354985, 1.8505232317580116],
      [0.8476579268189038, 1.3773230644835137, 1.3920482274364032],
      [0.42369219545642667, 2.862973440358568, 1.4087644283351977],
      [2.5898696473870118, 0.4434603388565952, 1.6635883647607153],
      [0.4726799023789304, 1.9687721791076043, 2.1588159450719218],
      [1.4896811525483706, 1.6347728282555751, 0.855977135485616],
      [1.4138476092640935, 1.1288011666882014, 1.4005804888924296],
      [1.0499160746118872, 2.2343643247466787, 0.9577514275652432],
      [2.284473907190847, 1.0421224566453704, 0.9748817153825469],
      [1.0326745701092543, 2.848606591070855, 0.83376222143891],
      [3.239259549061681, 0.8301844730076613, 0.9122488336440143],
      [1.3772458260192173, 2.233470172401452, 0.7994313787085936],
      [2.860584861040116, 3.657276007533073, 0.2495170928537842],
      [2.314333123959754, 0.5322556628276358, 2.25786291464151],
      [2.135579944854141, 1.6123452573116768, 0.9110188035232948],
      [3.3426840234790265, 0.5824100502143953, 1.6352972402375143],
      [3.4287709489380553, 1.5812122262803854, 0.6011387550898188],
      [1.6189982495409383, 0.9981092222193454, 2.038400510016909],
      [1.0594445462347704, 3.559577249876477, 0.9078419287534715],
      [4.3416433012163305, 0.7253957841847394, 1.1060512106160858],
      [0.8078080674722081, 4.528575743947709, 0.9790106224162238],
      [2.6773084933809237, 1.6402133887620285, 0.8757683643334202],
      [2.663450525483478, 2.5904395219051493, 0.5836720464971776],
      [3.64902992562933, 2.578616288992073, 0.43019567675642867],
      [1.6883799973690827, 2.235439247424064, 1.1297769862236358],
      [1.0725763779345567, 1.99465607239948, 2.0222297286599646],
      [0.8704994887840458, 6.275955176934964, 0.7933732576486542],
      [0.4819549960749491, 5.142539576878626, 1.7553034831607146],
      [1.866405660917501, 2.8573232978642866, 0.8899041103542937],
      [2.1381196577572057, 1.6922760840758584, 1.3179216394146673],
      [0.7075011521163915, 2.8660053950217055, 2.3980554623736277],
      [3.585924398003281, 0.6186696087693888, 2.202550610710431],
      [5.759494345238867, 0.6133112349408736, 1.4566570621855712],
      [0.6131685102308119, 3.794988463376021, 2.23661952018738],
      [0.525346724137868, 4.543736268396248, 2.212646482741996],
      [2.2544126227648515, 2.1594175834848466, 1.0984108440502722],
      [1.6928840494155888, 3.988906803131106, 0.8183479356765746],
      [2.168829549153638, 1.8396268445474189, 1.6403843567106535],
      [0.7569190161568777, 8.501796286446709, 1.396446520941598],
      [2.891958648261004, 3.625019477800729, 1.0083248796571793],
      [0.780434993406137, 7.194163759549463, 1.960657787819703],
      [6.638876254741959, 1.5590590880467348, 1.0845146087499766],
      [2.4369361146967456, 5.357068259665306, 0.862788258080787],
      [3.255059727916009, 2.255805203208215, 1.926089202916182],
      [1.2629328966140745, 11.506086349487308, 1.0519304275512695],
      [4.526428858439128, 4.49984819238836, 0.7585042308677326],
      [4.423542312953782, 5.376853486765988, 0.6678590282149935],
      [1.9327964476176671, 4.032320502826144, 2.402130198478698],
      [2.718241795897483, 7.297844663262369, 1.0682305432856083],
      [4.807532565934316, 6.890764457838875, 1.1515855299574989]
    ]

    rotations: [0, 1.57]
    iou_thr: [
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
    ]                # TBC

  augment:
    PointShuffle: true
    ObjectRangeFilter: true
    # random rotation of up to +- 45 degree for all axes
    Rotation:
      rotation_method: all
      rotation_range: [90, 90, 90] # [15, 15, 15]
    CameraDolly:  # depth camera translation along camera axis
      trans_range: [-0.5, 0.5]
      motion_axis: Z
      point_cloud_range: *point_cloud_range
    SensorNoise:
      type: stereo  # quadratic multiplicative noise in Z
      quad_mult_coeff: 0.003    # 30mm @ 3m for Occipital ST1
    # type: lidar   # noise std increases linearly with Z
    # linear_coeff: 0.0017      # 15.5mm @ 9m for L515


pipeline:
  name: ObjectDetection
  test_compute_metric: true
  batch_size: 4
  val_batch_size: 4
  save_ckpt_freq: 5
  max_epoch: 600
  main_log_dir: ./logs
  train_sum_dir: ./logs/train_log
  grad_clip_norm: 2
  num_workers: 4

  optimizer:
    lr: 0.001
    betas: [0.9, 0.999]
    weight_decay: 0 # 0.01
    amsgrad: true

  # evaluation properties
  overlaps: [
    0.35, 0.35, 0.35,
    0.35, 0.35, 0.35,
    0.35, 0.35, 0.35,
    0.35, 0.35, 0.35,
    0.35, 0.35, 0.35,
    0.35, 0.35, 0.35
  ]                     # TBC
  similar_classes: {
  }
  difficulties: [0, 1, 2, 3, 4]
