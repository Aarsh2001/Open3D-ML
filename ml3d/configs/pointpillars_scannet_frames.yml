dataset:
  name: Scannet
  # [scenes|frames] Use point clouds from entire scenes or individual frames
  portion: frames
  # path/to/your/dataset
  dataset_path: /mnt/beegfs/tier1/vcl-nfs-work/ssheorey/Open3D/Datasets/ScanNet-cache
  cache_dir: ./logs/cache
  max_size: [480, 48, null]
  #  steps_per_epoch_train: 5000

model:
  name: PointPillars
  # path/to/your/checkpoint
  ckpt_path:

  point_cloud_range: &point_cloud_range [-2.0, -2.0, 0, 2.0, 2.0, 3.2]   # TBC
  classes: [
    'cabinet', 'bed', 'chair', 'sofa', 'table', 'door', 'window',
    'bookshelf', 'picture', 'counter', 'desk', 'curtain',
    'refrigerator', 'showercurtain', 'toilet', 'sink', 'bathtub',
    'garbagebin'
  ]

  loss:
    focal:
      gamma: 2.0
      alpha: 0.25
      loss_weight: 1.0  #
    smooth_l1:
      beta: 0.11
      loss_weight: 2.0  #
    cross_entropy:
      loss_weight: 0.02  # /10

  voxelize:
    max_num_points: 64
    voxel_size: &vsize
      [0.025, 0.025, 3.2]             # TBC
    max_voxels: [9600, 19200]    # [P_train, P_test]

  voxel_encoder:
    in_channels: 3
    feat_channels: [64]  #
    voxel_size: *vsize

  scatter:
    in_channels: 64
    output_shape: [160, 160]

  backbone:
    in_channels: 64
    out_channels: [64, 128, 256]
    layer_nums: [3, 5, 5]   #
    layer_strides: [2, 2, 2]

  neck:
    in_channels: [64, 128, 256]
    out_channels: [128, 128, 128]
    upsample_strides: [1, 2, 4]
    use_conv_for_no_stride: false

  head:
    in_channels: 384
    feat_channels: 384
    nms_pre: 100
    score_thr: 0.1
    ranges: [                   # TBC
      [-2.0, -2.0, 0, 2.0, 2.0, 3.2]
    ]
    # Anchor box set spacing in voxels along each dimension
    # stride: 1
    # 36 anchors. mIoU=0.61
    sizes: [
        [0.3141678569448966, 0.3375618718238853, 0.33887480952233107],
        [0.2086426972747928, 0.8277709392800306, 0.6048096847918201],
        [0.5731485525706366, 0.45917908714554645, 0.553752277456671],
        [0.595403057447409, 0.8065703855135299, 0.5347558766741017],
        [0.2082962649138359, 1.4861464960754205, 1.0403382969620827],
        [1.0245256392077646, 1.2684736947069641, 0.25434765712670393],
        [0.47310605671912914, 1.7202724912737648, 0.4165208472454539],
        [0.8153665069287651, 0.5172036796128254, 0.8440333396411615],
        [0.7121287373407893, 0.35713785185910296, 1.5071361858272805],
        [0.4298576496780593, 0.8026165976306201, 1.1921162438826878],
        [0.6968415720666771, 0.9434020726704401, 0.7135372127391896],
        [0.2631203521072507, 2.0447804870174373, 0.9974409729612747],
        [1.4209336913509583, 0.6397341647937969, 0.610017932134042],
        [1.013444465831852, 2.0578921770956047, 0.2903327442568616],
        [2.040988456308625, 0.982101401315496, 0.3342409978708203],
        [0.3195680238609221, 1.1211620774850282, 1.9422388465083347],
        [1.0910417994803931, 0.8199014776972084, 1.048228368894422],
        [0.8151904062479871, 0.8568949788143717, 1.5587124783341877],
        [0.4964509349390784, 0.8624125989829705, 2.8759006318233755],
        [0.9972363622420781, 1.6016762332345102, 1.0310385110013356],
        [2.0925832684530583, 0.8445023891885887, 0.9618744267801347],
        [1.1872239177745318, 0.8649407543825067, 2.201149465104809],
        [2.0565504562964128, 2.0199799881068943, 0.5768379987379828],
        [0.6078510032966735, 2.1297466149805366, 2.019190764809783],
        [0.9020235861905597, 0.7951311698522081, 3.9712981060147294],
        [3.4503644523764, 0.8470075298520855, 0.9909367042376582],
        [2.238981591339941, 0.831783484329829, 1.659765725561372],
        [3.472097313722448, 1.9249572044664045, 0.5812831244235221],
        [1.8352363570796801, 0.7273017365322629, 2.9120413518503585],
        [3.020904175032916, 0.6503214558475041, 2.9034252562074574],
        [2.23680816146138, 1.5164617178568498, 1.9102079042354232],
        [0.8370925152585621, 2.3323182582855226, 3.764273935272582],
        [6.210291956600389, 1.3066157149641136, 1.0277376708231474],
        [1.2029476315886887, 1.194983767138587, 6.469984298282199],
        [4.056705523058364, 0.8304975980617961, 4.918838198719129],
        [1.3211009502410889, 1.1486637989679973, 11.157921791076658]
    ]

    rotations: [0, 1.57]
    iou_thr: [
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
      [0.35, 0.5],
    ]                # TBC

  augment:
    PointShuffle: true
    ObjectRangeFilter: true

pipeline:
  name: ObjectDetection
  test_compute_metric: true
  batch_size: 22
  val_batch_size: 22
  save_ckpt_freq: 5
  max_epoch: 300
  main_log_dir: ./logs
  train_sum_dir: ./logs/train_log
  grad_clip_norm: 2
  num_workers: 8

  optimizer:
    lr: 0.001
    betas: [0.9, 0.999]
    weight_decay: 0 # 0.01
    amsgrad: true

  # evaluation properties
  overlaps: [
    0.35, 0.35, 0.35,
    0.35, 0.35, 0.35,
    0.35, 0.35, 0.35,
    0.35, 0.35, 0.35,
    0.35, 0.35, 0.35,
    0.35, 0.35, 0.35
  ]                     # TBC
  similar_classes: {
  }
  difficulties: [0, 1, 2, 3, 4]
